{% extends "layout.html" %}

{% block title %}Teams - Football Data Pipeline{% endblock %}

{% block content %}
<div class="page-header">
    <h1>Teams</h1>
    <div style="color: var(--text-secondary);">
        Browse and specific team analysis
    </div>
</div>

<div class="card" style="margin-bottom: 1rem;">
    <input type="text" id="searchInput" placeholder="Search teams..."
        style="width: 100%; padding: 0.75rem; background: rgba(0,0,0,0.2); border: 1px solid var(--border-color); color: white; border-radius: 0.5rem;">
</div>

<div class="card">
    <table class="data-table" id="teamsTable">
        <thead>
            <tr>
                <th>Team Name</th>
                <th>League</th>
                <th>Stadium</th>
                <th>Founded</th>
            </tr>
        </thead>
        <tbody>
            <!-- Populated by JS -->
        </tbody>
    </table>
</div>
{% endblock %}

{% block scripts %}
<script>
    async function fetchTeams(query = '') {
        try {
            const url = query ? `/api/teams?q=${encodeURIComponent(query)}` : '/api/teams';
            const response = await fetch(url);
            const data = await response.json();

            const tbody = document.querySelector('#teamsTable tbody');
            tbody.innerHTML = data.map(t => `
                <tr onclick="window.location.href='/teams/${t.id}'">
                    <td style="font-weight: 600; color: var(--accent);">${t.name}</td>
                    <td>${t.league}</td>
                    <td>${t.stadium || '-'}</td>
                    <td>${t.founded || '-'}</td>
                </tr>
            `).join('');

            if (data.length === 0) {
                tbody.innerHTML = '<tr><td colspan="4" style="text-align: center; padding: 2rem;">No teams found.</td></tr>';
            }
        } catch (e) {
            console.error("Failed to fetch teams", e);
        }
    }

    // Search Listener
    let debounceTimer;
    document.getElementById('searchInput').addEventListener('input', (e) => {
        clearTimeout(debounceTimer);
        debounceTimer = setTimeout(() => {
            fetchTeams(e.target.value);
        }, 300);
    });

    fetchTeams();
</script>
{% endblock %}